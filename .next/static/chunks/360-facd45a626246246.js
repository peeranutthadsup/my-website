(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[360],{4360:function(e,i,s){"use strict";var t=s(5893),a=s(7294),c=s(1163);class l extends a.Component{componentDidMount(){this.loadColors(),this.loadCategories(),this.state.productId&&this.loadProduct(this.state.productId)}componentDidUpdate(e){var i,s,t,a;let c=(null===(i=e.router)||void 0===i?void 0:null===(s=i.query)||void 0===s?void 0:s.id)||null,l=(null===(t=this.props.router)||void 0===t?void 0:null===(a=t.query)||void 0===a?void 0:a.id)||null;l!==c&&this.setState({productId:l},()=>{l?this.loadProduct(l):this.setState({form:{product_key:"",product_name:"",product_category_id:"",color_id:"",qty:"",stock:"",purchase_price:"",lot:"",shipping_cost_piece:"",total_cost_including_shipping:"",sell_price_1:"",sell_price_2:"",sell_price_3:"",product_status:"",is_shopee:"",is_lazada:""},error:"",validationErrors:{}})})}loadColors(){fetch("/api/colors").then(e=>{if(!e.ok)throw Error("Failed to fetch colors: ".concat(e.status));return e.json()}).then(e=>{console.log("Colors loaded:",e),this.setState({colors:e})}).catch(e=>{console.error("Error loading colors:",e),this.setState({colors:[]})})}loadCategories(){console.log("Calling loadCategories()..."),fetch("/api/product_categories").then(e=>{if(!e.ok)throw Error("Failed to fetch categories: ".concat(e.status));return e.json()}).then(e=>{console.log("Categories loaded:",e),this.setState({categories:e})}).catch(e=>{console.error("Error loading categories:",e),this.setState({categories:[]})})}loadProduct(e){this.setState({loading:!0,error:""}),fetch("/api/products?id=".concat(e)).then(e=>{if(!e.ok)throw Error("Failed to load product data");return e.json()}).then(e=>{this.setState({form:{product_key:e.product_key||"",product_name:e.product_name||"",product_category_id:e.product_category_id?String(e.product_category_id):"",color_id:e.color_id?String(e.color_id):"",qty:e.qty||"",stock:e.stock||"",purchase_price:e.purchase_price||"",lot:e.lot||"",shipping_cost_piece:e.shipping_cost_piece||"",total_cost_including_shipping:e.total_cost_including_shipping||"",sell_price_1:e.sell_price_1||"",sell_price_2:e.sell_price_2||"",sell_price_3:e.sell_price_3||"",product_status:e.product_status||"",is_shopee:void 0!==e.is_shopee&&null!==e.is_shopee?String(e.is_shopee):"",is_lazada:void 0!==e.is_lazada&&null!==e.is_lazada?String(e.is_lazada):""},loading:!1,validationErrors:{}})}).catch(e=>this.setState({error:e.message,loading:!1}))}validateForm(){let{form:e}=this.state,i={},s={product_key:"รหัสสินค้า",product_name:"ชื่อสินค้า",product_category_id:"ประเภทสินค้า",color_id:"สี",qty:"จำนวน",stock:"สต็อก",purchase_price:"ราคาซื้อ",lot:"ล็อต",shipping_cost_piece:"ค่าขนส่งต่อชิ้น",total_cost_including_shipping:"ราคารวมค่าขนส่ง",sell_price_1:"ราคาขาย 1",sell_price_2:"ราคาขาย 2",sell_price_3:"ราคาขาย 3",product_status:"สถานะสินค้า",is_shopee:"Shopee",is_lazada:"Lazada"};return["product_key","product_name","product_category_id","color_id","qty","stock","purchase_price","lot","shipping_cost_piece","total_cost_including_shipping","sell_price_1","sell_price_2","sell_price_3","product_status","is_shopee","is_lazada"].forEach(t=>{(""===e[t]||null===e[t]||"string"==typeof e[t]&&""===e[t].trim())&&(i[t]="กรุณากรอก".concat(s[t]))}),i}render(){let{form:e,colors:i,categories:s,loading:a,error:c,validationErrors:l,productId:o}=this.state;if(a)return(0,t.jsx)("div",{children:"Loading..."});let r=(e,i)=>(0,t.jsxs)("label",{htmlFor:i,className:"form-label",children:[e," ",(0,t.jsx)("span",{style:{color:"red"},children:"*"})]});return(0,t.jsxs)("div",{className:"container py-3",children:[(0,t.jsx)("h2",{children:o?"แก้ไขสินค้า":"เพิ่มสินค้าใหม่"}),c&&(0,t.jsx)("div",{className:"alert alert-danger",children:c}),(0,t.jsxs)("form",{onSubmit:this.handleSubmit,noValidate:!0,children:[(0,t.jsxs)("div",{className:"mb-3",children:[r("รหัสสินค้า","product_key"),(0,t.jsx)("input",{type:"text",id:"product_key",name:"product_key",className:"form-control ".concat(l.product_key?"is-invalid":""),value:e.product_key,onChange:this.handleChange,required:!0}),l.product_key&&(0,t.jsx)("div",{className:"invalid-feedback",children:l.product_key})]}),(0,t.jsxs)("div",{className:"mb-3",children:[r("ชื่อสินค้า","product_name"),(0,t.jsx)("input",{type:"text",id:"product_name",name:"product_name",className:"form-control ".concat(l.product_name?"is-invalid":""),value:e.product_name,onChange:this.handleChange,required:!0}),l.product_name&&(0,t.jsx)("div",{className:"invalid-feedback",children:l.product_name})]}),(0,t.jsxs)("div",{className:"mb-3",children:[r("ประเภทสินค้า","product_category_id"),(0,t.jsxs)("select",{id:"product_category_id",name:"product_category_id",className:"form-select ".concat(l.product_category_id?"is-invalid":""),value:e.product_category_id,onChange:this.handleChange,required:!0,children:[(0,t.jsx)("option",{value:"",children:"-- เลือกประเภทสินค้า --"}),s.map(e=>(0,t.jsx)("option",{value:String(e.product_category_id),children:e.product_category_name},e.product_category_id))]}),l.product_category_id&&(0,t.jsx)("div",{className:"invalid-feedback",children:l.product_category_id})]}),(0,t.jsxs)("div",{className:"mb-3",children:[r("สี","color_id"),(0,t.jsxs)("select",{id:"color_id",name:"color_id",className:"form-select ".concat(l.color_id?"is-invalid":""),value:e.color_id,onChange:this.handleChange,required:!0,children:[(0,t.jsx)("option",{value:"",children:"-- เลือกสี --"}),i.map(e=>(0,t.jsx)("option",{value:String(e.color_id),children:e.color_name},e.color_id))]}),l.color_id&&(0,t.jsx)("div",{className:"invalid-feedback",children:l.color_id})]}),(0,t.jsxs)("div",{className:"mb-3",children:[r("จำนวน","qty"),(0,t.jsx)("input",{type:"number",id:"qty",name:"qty",className:"form-control ".concat(l.qty?"is-invalid":""),value:e.qty,onChange:this.handleChange,required:!0,min:0}),l.qty&&(0,t.jsx)("div",{className:"invalid-feedback",children:l.qty})]}),(0,t.jsxs)("div",{className:"mb-3",children:[r("สต็อก","stock"),(0,t.jsx)("input",{type:"number",id:"stock",name:"stock",className:"form-control ".concat(l.stock?"is-invalid":""),value:e.stock,onChange:this.handleChange,required:!0,min:0}),l.stock&&(0,t.jsx)("div",{className:"invalid-feedback",children:l.stock})]}),(0,t.jsxs)("div",{className:"mb-3",children:[r("ราคาซื้อ","purchase_price"),(0,t.jsx)("input",{type:"number",id:"purchase_price",name:"purchase_price",className:"form-control ".concat(l.purchase_price?"is-invalid":""),value:e.purchase_price,onChange:this.handleChange,required:!0,min:0,step:"0.01"}),l.purchase_price&&(0,t.jsx)("div",{className:"invalid-feedback",children:l.purchase_price})]}),(0,t.jsxs)("div",{className:"mb-3",children:[r("ล็อต","lot"),(0,t.jsx)("input",{type:"text",id:"lot",name:"lot",className:"form-control ".concat(l.lot?"is-invalid":""),value:e.lot,onChange:this.handleChange,required:!0}),l.lot&&(0,t.jsx)("div",{className:"invalid-feedback",children:l.lot})]}),(0,t.jsxs)("div",{className:"mb-3",children:[r("ค่าขนส่งต่อชิ้น","shipping_cost_piece"),(0,t.jsx)("input",{type:"number",id:"shipping_cost_piece",name:"shipping_cost_piece",className:"form-control ".concat(l.shipping_cost_piece?"is-invalid":""),value:e.shipping_cost_piece,onChange:this.handleChange,required:!0,min:0,step:"0.01"}),l.shipping_cost_piece&&(0,t.jsx)("div",{className:"invalid-feedback",children:l.shipping_cost_piece})]}),(0,t.jsxs)("div",{className:"mb-3",children:[r("ราคารวมค่าขนส่ง","total_cost_including_shipping"),(0,t.jsx)("input",{type:"number",id:"total_cost_including_shipping",name:"total_cost_including_shipping",className:"form-control ".concat(l.total_cost_including_shipping?"is-invalid":""),value:e.total_cost_including_shipping,onChange:this.handleChange,required:!0,min:0,step:"0.01"}),l.total_cost_including_shipping&&(0,t.jsx)("div",{className:"invalid-feedback",children:l.total_cost_including_shipping})]}),(0,t.jsxs)("div",{className:"mb-3",children:[r("ราคาขาย 1","sell_price_1"),(0,t.jsx)("input",{type:"number",id:"sell_price_1",name:"sell_price_1",className:"form-control ".concat(l.sell_price_1?"is-invalid":""),value:e.sell_price_1,onChange:this.handleChange,required:!0,min:0,step:"0.01"}),l.sell_price_1&&(0,t.jsx)("div",{className:"invalid-feedback",children:l.sell_price_1})]}),(0,t.jsxs)("div",{className:"mb-3",children:[r("ราคาขาย 2","sell_price_2"),(0,t.jsx)("input",{type:"number",id:"sell_price_2",name:"sell_price_2",className:"form-control ".concat(l.sell_price_2?"is-invalid":""),value:e.sell_price_2,onChange:this.handleChange,required:!0,min:0,step:"0.01"}),l.sell_price_2&&(0,t.jsx)("div",{className:"invalid-feedback",children:l.sell_price_2})]}),(0,t.jsxs)("div",{className:"mb-3",children:[r("ราคาขาย 3","sell_price_3"),(0,t.jsx)("input",{type:"number",id:"sell_price_3",name:"sell_price_3",className:"form-control ".concat(l.sell_price_3?"is-invalid":""),value:e.sell_price_3,onChange:this.handleChange,required:!0,min:0,step:"0.01"}),l.sell_price_3&&(0,t.jsx)("div",{className:"invalid-feedback",children:l.sell_price_3})]}),(0,t.jsxs)("div",{className:"mb-3",children:[r("สถานะสินค้า","product_status"),(0,t.jsxs)("select",{id:"product_status",name:"product_status",className:"form-select ".concat(l.product_status?"is-invalid":""),value:e.product_status,onChange:this.handleChange,required:!0,children:[(0,t.jsx)("option",{value:"",children:"-- เลือกสถานะสินค้า --"}),(0,t.jsx)("option",{value:"available",children:"พร้อมขาย"}),(0,t.jsx)("option",{value:"out_of_stock",children:"หมดสต็อก"}),(0,t.jsx)("option",{value:"discontinued",children:"เลิกขาย"})]}),l.product_status&&(0,t.jsx)("div",{className:"invalid-feedback",children:l.product_status})]}),(0,t.jsxs)("div",{className:"mb-3",children:[r("Shopee","is_shopee"),(0,t.jsxs)("select",{id:"is_shopee",name:"is_shopee",className:"form-select ".concat(l.is_shopee?"is-invalid":""),value:e.is_shopee,onChange:this.handleChange,required:!0,children:[(0,t.jsx)("option",{value:"",children:"-- เลือก --"}),(0,t.jsx)("option",{value:"1",children:"ใช่"}),(0,t.jsx)("option",{value:"0",children:"ไม่ใช่"})]}),l.is_shopee&&(0,t.jsx)("div",{className:"invalid-feedback",children:l.is_shopee})]}),(0,t.jsxs)("div",{className:"mb-3",children:[r("Lazada","is_lazada"),(0,t.jsxs)("select",{id:"is_lazada",name:"is_lazada",className:"form-select ".concat(l.is_lazada?"is-invalid":""),value:e.is_lazada,onChange:this.handleChange,required:!0,children:[(0,t.jsx)("option",{value:"",children:"-- เลือก --"}),(0,t.jsx)("option",{value:"1",children:"ใช่"}),(0,t.jsx)("option",{value:"0",children:"ไม่ใช่"})]}),l.is_lazada&&(0,t.jsx)("div",{className:"invalid-feedback",children:l.is_lazada})]}),(0,t.jsx)("button",{type:"submit",className:"btn btn-primary",children:o?"บันทึกการแก้ไข":"เพิ่มสินค้า"})]})]})}constructor(e){var i,s;super(e),this.handleChange=e=>{let{name:i,value:s}=e.target;this.setState(e=>{let t={...e.validationErrors};return""!==s.trim()&&delete t[i],{form:{...e.form,[i]:String(s)},validationErrors:t}})},this.handleSubmit=async e=>{e.preventDefault(),this.setState({loading:!0,error:""});let i=this.validateForm();if(Object.keys(i).length>0){this.setState({validationErrors:i,loading:!1});return}try{let{router:e}=this.props,{form:i,productId:s}=this.state,t=s?"PUT":"POST",a=s?"/api/products?id=".concat(s):"/api/products",c=await fetch(a,{method:t,headers:{"Content-Type":"application/json"},body:JSON.stringify(i)});if(!c.ok){let e=await c.json();throw Error(e.message||"Failed to save product")}alert(s?"แก้ไขสินค้าเรียบร้อย":"เพิ่มสินค้าเรียบร้อย"),e.push("/ProductList")}catch(e){this.setState({error:e.message})}finally{this.setState({loading:!1})}};let t=(null===(i=e.router)||void 0===i?void 0:null===(s=i.query)||void 0===s?void 0:s.id)||null;this.state={productId:t,form:{product_key:"",product_name:"",product_category_id:"",color_id:"",qty:"",stock:"",purchase_price:"",lot:"",shipping_cost_piece:"",total_cost_including_shipping:"",sell_price_1:"",sell_price_2:"",sell_price_3:"",product_status:"",is_shopee:"",is_lazada:""},colors:[],categories:[],loading:!1,error:"",validationErrors:{}}}}i.Z=(0,c.withRouter)(l)},1163:function(e,i,s){e.exports=s(6885)}}]);